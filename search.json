[{"title":"校园跑方案（同天智慧树）","url":"/post/run.html","content":"\n  4630436162ade97ba2718b7d0c4b3b63cb3a3f659c5ca08b4bca0f5845928186fc2e4ebfd0709bfd9a0400faa9ff57a037205f1fd37f149dc05dcac635cd218db17c5656f86519b8edeb5851fb0b8e42387fc63b3d693c0812101f9e8455f5fa80e1e03af195a740bf8f15206bed393a5c0f9830cbdbcabe439fe476bff6e6d786c156bc6e4b5cab751cd21c285d67d5db20d8ecaae7bb50066473ff26eee664bbc58b154b8ddb31dd72e29e6d0cee6c7fd07fc846029b84f8ff51c482d6139cb45643da17e2c2e8c2d15953a99ee105d06f1891bb3c965d2e904e24f2193dd886eb8b8c1bff8facc2a88c3c23b236e9c75f1925a819f0d65d4188cc5ee85d2ee00124995b26fa7e6e2a5196642f3cb7664fd2b9a0476cf6b8668b556dd470b302f8324a2420ec7db1316092818917f7b579f00a9e83672db7880076348e2a6e37caefcaa39679367fdef98e44b833a72283950ddc108999c7e76f83da52915c10dcf8b58566167ad0d7ece02f2a4161d29d884b29f73c418bad22923c176f2e3dd3ff72702904dcfa650735ea6f02e121427f620256de185bde0d752613493bdde1b03684bf50d1f296eb2c08b0d9eb5d256364f02bccdd774f3aacec415f2d8c406ec686ec11f7c9d811f7bb2b644bdee0f1bd4407451f04c6bc2d384f289c3aa0ed2f573339d708440690ee34c12848ddeafe0b66b10a75477cedfa0808d8ac574993f8d4c3b90cb282c033833a282e73e741fdce3ba6853e97f3e26dce2f4bec62c261991bc91e699988cf073cd4b6810a8c792b5e6d736664189a76302cde3419a36e512f528b8e3f9dc1938d5377ddefdcd664ccb4f076a229a02a899d6e0227dac836361f026b2c774767a2e4902dfb143fc493d547d5c12a8e6156b40d11b78ae769964a227df045b7c6b9b6a727b71a745704973546aabb0cf97913f36f1baec58d5ff627fdcc245eba4afa33a054d1691c88dcc4c71d6bfc81a16638ad7404251d017f7e1ac4364fc5e8f330881fcd8f5e5775fe2339444016b1582c10fd50314033c370eb62ebf8730a0fab67d419e79b6e52ba7d2f3454aa11748cc5141d72fe3d9da72a35caf452b7adc5eb0fdcc169151e3c86dea0396ed07c21b2a8a3b935cb95262f8ae78588b88b189462e39495fa5a991f72355f3731ae1946e9ed56bad548d795c599ad184bfe443436192ff3c3c8d5e73cf49a3b3d39e7c722f7633679ca9df1a501656be72ac9578b43b46da712d135822a8067ad0519e97dab986773acc877943993ed470da2c5dcf540c01ecb3d5e217a4071920ea99109452210bbd10f9730688396899ae78712794181e914383e267dc581b53a5073d582bc8e2e28eafe234f0c78bac9fb9309530b981d9276d98988cb534ce36eefacf7c6dfe5f715b25101fe64feec88ea89079d21a719e4c311419f495c881df20ca3834858498eb3e61d7cf2ee8f52ef671eb636d82023421e5c47f498d5a4b5f839746c37ec64aeb9b3ec6ff05b3e5d88b143534b8e20dd1f78590a64d2c5f86142819103f9608ec0b8b34ee45be4854e4b65609ad653814569a6753fe11a6c1346cab49885d6a616d735470a858a4f855a5f59926390d64046e925325afcfff155e17fb71fcb2b65600a66fe14c090c292c71e252eeef9faadfad513990f70ba94a7d5cdacebd27413e3c463e528efa8f0d69faad677f000b15c3357c5eefb24d10b7d2f514407ceb1af4976fa232270aaddd554ff1b1f4e11405573d26bc4b5c4df03f3397abd8b3251c370fa99c147b5df11b9655f29493bcb91a8204cc34257872ce39613d9372f7b2c35eb14205f64dd790300ffb00bd5430d9c684b9fbdbf2e284bb87d10894d13d45f500737b7546bf75f986312ba4f0bbac54d7fec526e4431cb0e29b3d59b8fb6c05fb22d17c7e34f30de3149d745073771820ee08ea5edf3b380b85a6c9bbe752dd30ca227a7d3279e5f1126ff65c97b1628566440fd853867335133dd1dc121e5996db9431aa0dc28cba052d9837d61c355c3a9ca89aeaa55000fd115087768158ba79dbd0439f457096b4cb4c5639757015abffeb736f9a61b842bad7384d6f9c80b7950c9428d5c4ed6aee8f2bd326258c682282b8ef49280b8127f7d57dca6640d0593c186b0f752555711a9c51fada68792535568e08257d4cda1bc13f108b0c77a3ec93d48a9270c9ab743ebbb8163360b8b06b417e22074921b4d8034162ad8a3cf9cf37d0e4ec1b513dfce6a4ef742c3261b543e378b07eb6d832c0e52568b1663fe01cdc41fc425e3d56df547c37f1c0bd2d99819ab33fd0e50df2971a5ed2e9909aeb39bea3a36daea10ce26df8eb7f8c1ffe0ebfeb684c8e18c7915f1d71f4a429a39a078d5a49855df128e3dfe9bc6de04cd4c111aed6ed915b7ee68d570939a5782eddde689b64060e77d8c667a5e1ed3443e39f5b964279b03b35db4b75ac3955261ef5b8228ed9d7e40c860adf3eaff408603df72834d629b18dd9dca1944045c60935bc99fcf3dc84f2c28a598b5b8db68efb15ac3d685fc2bc42f6be216f8079fe41a5dea173cfb113bbfcc4756b9fc3b49a4119abe6530dad6fdfcb3a9cce13655ae45e7c8f67ab8967960f012c68de61e71114a90e3e16ef304e9ade5121c4475cc54c66fa49a15cc7175d5dd989956444e4033dded88a03cb4324f220f2de778c69cb0b9a3abd3036a1875e4b0948f3383425ccf3889e109a055a0f2c3735bd09a1cf7297d93e7b62efc9607925de850e3bee0c6b2c2238e2f2dd8da43793b176b30128381d5fa8595b176d24b39f9d4ea4ef446c0ced7c50a630acc96af25ff1ae68846558babe3f8cc87af9a3377acc33ea7200811ec98e649113ed48640e8a20a31877f45665a847fe77454e02891f0a45bace2e03d99072dd9f9db123b385782836352a504e6cde08851069ef6b870f6a3da19fd48545eb6ef443efd02e9de7cfeb350161bad8eaddb9f82db04aeed3db2d234ba73683a2d851ee63a0f1f0801b9db57567872141c66076d000842aeba24a181266168877c273f57b5b5c3d96a2c6fd2db945adf1c1ef9fb736d3986d363ba0b8d3b8f266ee39137146ace32c13f9704d4e8369ed36e9e758ff8b12d3b615eb7046fcd2be8b3dfc3c2e0d581aedf32fec29969\n  \n    \n      \n      \n        Hey, password is required here.\n      \n    \n  \n\n","tags":["其他"]},{"title":"熊猫烧香病毒分析（上）","url":"/post/1f2365ca.html","content":"准备样本信息：\n文件名：xiongmao.txt\nMD5：512301c535c88255c9a252fdf70b7a03\nSHA256:40fee2a4be91d9d46cc133328ed41a3bdf9099be5084efbc95c8d0535ecee496\n大小：30,001 字节\n实验环境与工具：虚拟环境：windows_7_ultimate_with_sp1_x86\n工具：IDA_Pro、x64dbg、PCHunter、HRSword、DIE_win32   （由于HRSword进程总是被病毒干掉，得结合着PCHunter和录屏来看）\n行为分析tips:由于是在win7系统中进行的行为分析，我们需要使用以管理员身份运行。在win xp系统中，默认用户拥有管理员权限，无需授权的执行就可以修改系统文件，这也就给计算机病毒提供了温床。\n1.启动资源管理器发生闪退病毒成功运行。\n2.复制到drivers路径下：\n并创建相关启动项\n\n\n3.程序的exe文件被“感染”\n4.创建大量Desktop.ini文件几乎每个路径下都有，只写入了创建时间。\n\n\n5.在C盘根目录下创建setup.exe和autorun.inf\n两个文件有隐藏属性\n\n病毒作者意图是访问c盘或插入U盘时，自动启动setup文件，但这个样的设计已经在win7即更高版本的Windows系统中失效。\n- Windows 7 及更新系统默认禁用 U盘移动硬盘的 autorun.inf 自动运行功能（仅保留光驱支持）。- 需手动打开设备或触发右键菜单才会执行程序。\n\n6.网络方面\n\nSYN_SENT 状态（端口139）： 大量向不同内网IP的139端口发起连接请求，表明内网扫描行为，用于探测漏洞或横向传播恶意软件（如利用SMB协议漏洞）。\nESTABLISHED 状态（端口80）： 成功连接至192.168.42.1:80，可能意图是恶意软件与C2服务器通信或数据外传\n\n二进制文件分析：查壳与脱壳：查壳：是有壳的。FSG工具打包\n\n简单说一下怎么脱，上面的DIE被扰乱了，实际只有FSG壳，这个样本同时具有FSG壳OEP特征和DelPhi编译器入口特点，很好找OEP，scylla普通模式找IAT表，然后dump+fix dump，就可以了。\n\n\n\n能看到还是恢复了很多东西。\n逆向伪代码分析：\n\nj_XXXXX是识别出来的系统函数名\nC_XXXX是分析过后的自定义的，逻辑分析得比较清晰可信的函数名\nM_XXXX是未细致分析过的自定义的，根据上下文初步猜测的函数名\nsub_XXXX则是IDA根据函数偏移命名的函数名\n\n动态调试分析：通过调试结果，观察运行后变量表现，推测函数功能\n执行前：（C_GetAbsolutePath）\n\n执行后：\n\n\n参数在函数执行前后的变化很明显，获得该程序的绝对路径。\n静态分析：通过对已确认函数名的调用，分析该函数的功能：\n\n通过j_GetCommandLineA和j_GetModuleFileNameA可以分析出sub_40277c与获取路径相关。\n分析结果：C_mian（部分）:\nC_GetParentCatalogue：\n未完待续~~~","tags":["病毒分析"]},{"title":"熊猫烧香病毒分析（下）","url":"/post/a79f02af.html","content":"最后进行病毒专杀和文件修复的工作。\n病毒专杀：由于现流行的编程语言版本和编译器版本编写专杀工具需要解决兼容win7_x32的问题，我就不花心思去解决了。我们可以使用批处理文件来实现。\n程序需要实现的功能：\n\n \n删除并结束spo0lsv进程\n\n \n遍历每个盘，找到并删除setup.exe和autorun.inf，要避免误杀同名文件。\n\n \n遍历路径，查找并删除Desktop_.ini,同样要避免误杀同名文件。\n\n \n修改注册表，删除Software\\Microsoft\\Windows\\CurrentVersion\\Run\\svcshare和SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Folder\\Hidden\\SHOWALL\\CheckedValue\n\n\n批处理文件实现：@echo offsetlocal enabledelayedexpansionREM 提升为管理员权限（需保存为.bat运行）NET FILE &gt;NUL 2&gt;&amp;1 || (powershell -Command &quot;Start-Process &#x27;%~f0&#x27; -Verb RunAs&quot; &amp; exit b)REM ██████ 终止进程并删除驱动文件 ██████taskkill F IM spo0lsv.exe &gt;nul 2&gt;&amp;1if exist &quot;C:\\windows\\System32\\drivers\\spo0lsv.exe&quot; (    attrib -H -S &quot;C:\\windows\\System32\\drivers\\spo0lsv.exe&quot; &gt;nul 2&gt;&amp;1    del F Q &quot;C:\\windows\\System32\\drivers\\spo0lsv.exe&quot; &gt;nul 2&gt;&amp;1    echo 已删除 spo0lsv.exe)REM ██████ 遍历所有盘符删除隐藏的病毒文件 ██████for f &quot;skip=1&quot; %%d in (&#x27;wmic logicaldisk where &quot;DriveType=2 OR DriveType=3&quot; get name&#x27;) do (    set &quot;drive=%%d&quot;    if defined drive (        echo 深度扫描盘符: !drive!                REM ─── 处理根目录隐藏文件 ───        for %%f in (&quot;!drive!\\setup.exe&quot; &quot;!drive!\\autorun.inf&quot;) do (            if exist %%f (                attrib -H -S -A %%f &gt;nul 2&gt;&amp;1                del F Q %%f &gt;nul 2&gt;&amp;1                echo 已清除根目录隐藏文件: %%f            )        )                REM ─── 递归处理子目录（含隐藏文件）───        for f &quot;delims=&quot; %%f in (&#x27;dir !drive!\\* s b a:-d a:h 2^&gt;nul ^| findstr i &quot;\\\\setup.exe$ \\\\autorun.inf$&quot;&#x27;) do (            set &quot;filepath=%%f&quot;            REM 排除系统关键路径            if not &quot;!filepath:\\Windows\\=!&quot;==&quot;!filepath!&quot; (                echo 跳过系统文件: %%f            ) else if not &quot;!filepath:\\Program Files\\=!&quot;==&quot;!filepath!&quot; (                echo 跳过程序文件: %%f            ) else (                attrib -H -S &quot;%%f&quot; &gt;nul 2&gt;&amp;1                del F Q &quot;%%f&quot; &gt;nul 2&gt;&amp;1                echo 已删除隐藏病毒文件: %%f            )        )    )):: 全盘遍历所有Desktop_.ini（严格匹配带下划线的文件名）set &quot;drive=C:&quot;REM 递归搜索并强制删除所有隐藏的Desktop_.ini文件for f &quot;delims=&quot; %%f in (&#x27;dir a:h s b &quot;%drive%\\Desktop_.ini&quot;&#x27;) do (    del F Q A:H &quot;%%f&quot; &gt;nul 2&gt;&amp;1    if exist &quot;%%f&quot; (        echo 删除失败（可能被占用或权限不足）: %%f    ) else (        echo 已删除: %%f    ))REM ██████ 注册表修复 ██████reg delete &quot;HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\svcshare&quot; f &gt;nul 2&gt;&amp;1reg delete &quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Folder\\Hidden\\SHOWALL\\CheckedValue&quot; f &gt;nul 2&gt;&amp;1echo 注册表修复完成pause\n\n文件恢复：逆向感染代码：我们重新关注C_InfectFile(sub_407F00):\n\n大致逻辑：\n\n是把自己复制到目标文件目录下，伪装成目标文件（直接覆盖目标文件）\n\n把目标文件附加到伪装文件之后\n\n再在伪装文件之后添加一段字符串（”WhBoy”+”原文件名”+“.exe”+02+“原文件字节数”+01）\n\n这就实现了病毒“感染”。\n\n\n编程文件恢复：流程如下：\n\n 识别被感染的病毒——可以通过末尾字符串识别。\n 删除病毒部分——删除文件前30001个字节，这个部分应该建议通过计算原病毒大小来动态处理。\n 删除文件最后的字符串标识。\n\n批处理文件实现：代码如下：\n::C:\\Program Files\\IDA 6.8\\idaw64.exe@echo offsetlocal enabledelayedexpansion:: 必须用管理员运行（右键选&quot;以管理员身份运行&quot;）set &quot;target_file=文件路径&quot;:: 阶段1：安全截断前30001字节powershell -Command &quot;$f=&#x27;%target_file%&#x27;; if (Test-Path $f) &#123; $b=[IO.File]::ReadAllBytes($f); [IO.File]::WriteAllBytes($f, $b[30001..($b.Length-1)]) &#125; else &#123; exit 1 &#125;&quot;:: 阶段2：精准解析尾部标识符powershell -Command &quot;$f=&#x27;%target_file%&#x27;; $bytes=[IO.File]::ReadAllBytes($f); $sepIndex=$bytes.Length-1; while($sepIndex -ge 0 -and $bytes[$sepIndex] -ne 2)&#123;$sepIndex--&#125;; $numStr=-join[char[]]$bytes[($sepIndex+1)..($bytes.Length-1)] -replace &#x27;[^0-9]&#x27;,&#x27;&#x27;; [IO.File]::WriteAllBytes($f, $bytes[0..([int]$numStr-1)]); echo 修复成功，最终大小: $numStr 字节&quot;pause\n\n\n心得：  这个病毒总的分析下来学到很多东西，编写者具有很强的工程思维，逻辑缜密，代码功力也很强。\n最后：\n\n\n太恐怖了，一觉醒来，就要攻击宿主机了。虚拟机网络还是设置成hostonly模式，并且宿主机关闭该局域网的”Internet 协议版本4（TCPIPv4）”才是安全的。\n"},{"title":"熊猫烧香病毒分析（中）","url":"/post/22c6f24d.html","content":"\nsub_40819C:预备阶段实现对原病毒所在路径下的desktop.ini文件的删除和将自己复制到drivers路径下并启动\nv55 &#x3D; __readfsdword(0)sub_40819C函数开头的 v55 &#x3D; __readfsdword(0)可以反编译成\nExceptionList = NtCurrentTeb()-&gt;NtTib.ExceptionList;\n\n和\n__writefsdword(0, &amp;v55);\n\n一起处理异常。\n查找Desktop_.ini并删除：检测是否存在该文件，若存在，先修改其属性为隐藏，再进行删除。\n\n这段代码并不是我们之前观察到的创建Desktop_.ini文件实现代码。\n自我复制到C:windowsSystem32drivers路径下：先检测是否已经存在该进程和文件，有就先kill该进程和修改属性，再获取System32路径，拼接路径，自我复制到驱动目录下再运行，最后退出当前进程。\n\nsub_407B68（）：自毁程序:try1del &quot;原程序.exe&quot;      → 尝试删除被锁定的程序文件if exist &quot;原程序.exe&quot; goto try1 → 循环检测直到进程退出ren &quot;原程序.exe&quot; 临时名称 → 解除文件锁定后重命名del 临时名称          → 删除重命名后的文件del %0               → 最后删除批处理自己\n\n当程序自然退出后，批处理文件将会开始执行。\nsub_40D18C:爆发阶段实现对各目录下Desktop_.ini文件的创建，对其余文件的感染，和setup.exe文件的创建，以及实现内网横向渗透\nsub_0040A5B0:创建线程执行：sub_40A48C：\n\n来执行遍历路径，创建Desktop_.ini文件和感染可执行文件的逻辑（读取系统时间并写入）：\n\n感染可执行文件相关：\n\nC_InfectFile：\n\nsub_40C374：设置一个6s的计时器运行TimerFunc函数，TimerFunc核心逻辑就是在系统盘创建setup.exe和相应的自启动文件autorun.inf。\nsub_40BACC： 创建线程，执行网络连接，实现横向内网渗透，通过SMB协议扫描：\nSystem::BeginThread(sub_40BA8C, 0, 0, &amp;v6, 0, 0, v3); 多线程运行,横向内网渗透，\n\nsub_40D088:对抗安全查杀恶意下载与执行相关，对抗安全软件和监控\n设置了6个计时器：\n\n\n\n定时器地址\n时间间隔\n回调函数\n功能描述\n\n\n\n0x3E8u\n1秒\nsub_40CEE4\n创建自启动项 (spo0lsv)，实现持久化\n\n\n0x124F80u\n20分钟\nsub_40D040\n核心恶意下载模块（可能下载远控木马或勒索组件）\n\n\n0x2710u\n10秒\nsub_40D048\n下载后抹除痕迹（删除日志、加密通信等）\n\n\n0x1770u\n6秒\nsub_407430\n系统性终止安全软件服务，删除注册表启动项（针对性对抗杀软）\n\n\n0x2710u\n10秒\nsub_40CC4C\n隐蔽数据下载（可能用于泄露敏感信息或接收指令）\n\n\n0x1B7740u\n30分钟\nsub_40C728\n二次恶意下载（更新组件或下载额外攻击载荷）\n\n\n特别是在sub_40CEE4函数中的sub_406E2C函数：\n执行sub_4061B8，实现通过关闭安全软件窗口、终止关键进程、模拟用户操作，破坏系统防御能力，确保恶意程序持续运行：\n\n最后把分析的思维图放到最后：\n\n","tags":["病毒分析"]},{"title":"雷电模拟器&IDA动调.so文件","url":"/post/android.html","content":"前提：雷电模拟器开启root权限，模拟器设置中开启开发者模式&amp;&amp;USB调试\n\nadb push ../../../../android_x64_server \\data\\local\\tmpadb forward tcp:23946 tcp:23946adb shellsucd data/local/tmpchmod 777 android_x64_server./android_x64_server      #在进入adb shell 之前，可以先获得临时root身份（adb root），进入shell之后再获得超级管理员权限(su)\n\n虚拟机中运行apk，用ida打开.so文件：\n\n1.IDA打开so文件，定位到待分析函数并下断点：【New】【Export或Function window搜索函数双击定位】\n\n2.附加程序，进入动态调试界面：【Debugger—&gt;Process options】【Hostname:127.0.0.1 Port:23946】然后【Debugger—&gt;Attach to Process】\n\n\n\n找到自己想要的进程，attach.\n","tags":["安卓逆向"]}]